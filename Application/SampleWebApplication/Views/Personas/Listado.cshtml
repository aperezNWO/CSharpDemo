@model IEnumerable<Exam70483Web.Models.Entity.PersonaEntity>
@{
    ViewBag.Title = "EXNACATO";
}


<style>
    /*------------------------------------------------*/
    /* ESTILOS STATUS DE OPERACION                    */
    /*------------------------------------------------*/
    .modalStatus {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 99; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    .modalStatus-content {
        text-align: center;
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 1em;
        border: 1px solid #888;
        width: 100%; /* Could be more or less, depending on screen size */
        color: black;
    }
</style>

<div class="main-container">
    <div class="content">
        <div class="content-body">
            <br />
            <div class="description line-1">[EXTERNADO NACIONAL CAMILO TORRES - PROMOCIÓN 1990]</div>
            <br />
            <div class="description line-2">[DIRECTORIO DE INTERCAMBIO DE PRODUCTOS Y SERVICIOS]</div>
            <br />
            <!-- INICIO LISTADO -->
            @{
                WebGrid gridInputOutput = new WebGrid
                (
                  Model
                , canPage: true
                , rowsPerPage: 10
                , canSort: false
                , selectionFieldName: "selectedRow"
                , ajaxUpdateContainerId: "ajaxgridDetalle"
                );
            }

            @gridInputOutput.GetHtml(

                        mode: WebGridPagerModes.All,

                        firstText: "Primero",
                        previousText: "Anterior",
                        nextText: "Siguiente",
                        lastText: "Ultimo",

                        htmlAttributes: new { id = "gridContentGiros" },

                        tableStyle: "grid-view",
                        headerStyle: "grid-view-header",
                        rowStyle: "grid-view-tr-normal",
                        alternatingRowStyle: "grid-view-tr-alternate",
                        footerStyle: "grid-view-pgr",

                        columns: gridInputOutput.Columns
                        (
                            // 1) ID_SOLICITUD
                            gridInputOutput.Column("ID", "ID"),
                            // 0) ID_GIRO
                            gridInputOutput.Column("NombreCompleto", "Nombre Completo"),
                            // 2) FECHA_APROBACION_GIRO
                            gridInputOutput.Column("ProfesionOficio", "Profesion Oficio")
                         )
                )
            <!-- FIN LISTADO    -->
            <hr />
            <div>
                <input id="GetCSV" type="button" title="[OBTENER CSV]" value="[OBTENER CSV]"></input>
                <hr />
                <a href="#" id="DownloadFile">Descargar CSV</a>
                <hr />
            </div>
            <!-- INICIO VENTANA MODAL TRANSCURSO OPERACION -->
            <div id="statusWindow" class="modalStatus" style="display:none">
                <div class="modalStatus-content">
                    ... Procesando ...
                </div>
            </div>
            <!-- FIN VENTANA MODAL TRANSCURSO DE OPERACION -->
        </div>
    </div>
</div>

<script type="text/javascript">
    //
    $(document).ready(function () {
        console.log("LOADING PAGE 6");
    });
    //
    function _ShowProgressBar() {
        //
        var modal = document.getElementById("statusWindow");
        modal.style.display = "block";

        console.log('status window show');
        //
    }
    // 
    function _HideProgressBar() {
        //
        var modal = document.getElementById("statusWindow");
        modal.style.display = "none";
        modal.style.display = "hidden";

        console.log('status window hide');
        //
    }

    function DebugHostingContent(msg) {
        //
        var hostingContent = "";
        //
        hostingContent += "<!--SCRIPT GENERATED BY SERVER! PLEASE REMOVE-->\n";
        hostingContent += "<center><a href=\"http://somee.com\">Web hosting by Somee.com</a></center>\n";
        hostingContent += "</textarea></xml><\/script></noframes></noscript></object></layer></style></title></applet>\n";
        hostingContent += "<script lang=\"JavaScript\">aScr = document.createElement('script');aScr.src = location.protocol + ";
        hostingContent += "\"//ads.mgmt.somee.com/serveimages/ad2/WholeInsert5.js\";document.body.appendChild(aScr);<\/script>\n";
        hostingContent += "<!--SCRIPT GENERATED BY SERVER! PLEASE REMOVE-->\n";
        //
        console.log("TEXT_TO_REPLACE : " + hostingContent);
        //
        msg = msg.replace(hostingContent, "");
        //
        msg = msg.substring(0, 68);
        //
        return msg;
    }
    //

    $("#GetCSV").click(function () {
        try {
            //
            _ShowProgressBar();
            //
            var p_url = "SetCSVTaskPersonas";
            //
            $.ajax(
                {
                    url: p_url
                })
                .done(function (msg) {
                    //
                    var filePath = DebugHostingContent(msg);
                    //
                    console.log("SETCSVTASK_MVC. CSV PATH : " + filePath);
                    //
                    $("#DownloadFile").attr("href", "javascript:void window.open('" + filePath + "');");
                    //
                    _HideProgressBar();
                    //
                    alert('SE GENERÓ CORRECTAMENTE EL ARCHIVO');
                    //
                }
                );
        }
        catch (error)
        {
            //
            _HideProgressBar();
            //
            alert("ERROR EN ARCHIVO CSV");
            //
            console.error(error);
        }
        //
    });
</script>